<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listen to Music</title>
    <style>
        body, html { height: 100%; margin: 0; padding: 0; font-family: sans-serif; overflow: hidden; }
        
        /* 背景模糊層 */
        #bg-blur {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #333 no-repeat center center; background-size: cover;
            filter: blur(30px) brightness(0.5); z-index: -1; transform: scale(1.1);
        }

        .container {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; color: white; padding: 20px; overflow-y: auto;
        }

        .cover-art {
            width: 200px; height: 200px; border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5); margin-bottom: 20px;
            object-fit: cover; background: #000;
        }

        h1 { font-size: 1.5em; margin: 0 0 30px 0; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }

        /* 按鈕樣式 */
        .platform-btn {
            display: flex; align-items: center; justify-content: center;
            width: 100%; max-width: 300px; padding: 14px; margin-bottom: 12px;
            border-radius: 30px; text-decoration: none; color: white; font-weight: bold;
            transition: transform 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            background: #444; /* 預設顏色 */
        }
        .platform-btn:hover { transform: scale(1.03); }

        /* 各平台專屬色 */
        .spotify { background: #1DB954; color: black; }
        .apple { background: #FA243C; }
        .kkbox { background: #00AEC8; }
        .youtube { background: #FF0000; }
        
        .logo-icon { margin-right: 10px; font-style: normal; }
    </style>
</head>
<body>
    <div id="bg-blur"></div>
    
    <div class="container">
        <img id="cover" class="cover-art" src="">
        <h1 id="title">Loading...</h1>
        <div id="links-area" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzf5nq4HNJy-lzPy9BIDqm9ByR2dmTEu5wE_LItSPuIqRrkhe6b1hd7NwNakuryxEY2/exec"; // ★請替換
        const params = new URLSearchParams(window.location.search);
        const songId = params.get('id');

        fetch(`${API_URL}?action=getSong&id=${songId}`)
            .then(r => r.json())
            .then(data => {
                if(data.error) {
                    document.getElementById('title').innerText = "找不到歌曲";
                    return;
                }

                // 1. 設定畫面資訊
                document.title = "Listen to " + data.title;
                document.getElementById('title').innerText = data.title;
                document.getElementById('cover').src = data.coverUrl;
                document.getElementById('bg-blur').style.backgroundImage = `url('${data.coverUrl}')`;

                // 2. 動態生成按鈕
                const linksArea = document.getElementById('links-area');
                const links = data.links;
                
                // 定義顯示邏輯與樣式
                const platforms = [
                    { key: 'spotify', label: 'Play on Spotify', class: 'spotify' },
                    { key: 'apple', label: 'Apple Music', class: 'apple' },
                    { key: 'kkbox', label: 'KKBox', class: 'kkbox' },
                    { key: 'youtube', label: 'Watch on YouTube', class: 'youtube' }
                ];

                platforms.forEach(p => {
                    const url = links[p.key];
                    if (url && url.trim() !== "") {
                        const a = document.createElement('a');
                        a.href = url;
                        a.target = "_blank";
                        a.className = `platform-btn ${p.class}`;
                        a.innerText = p.label;
                        linksArea.appendChild(a);
                    }
                });
            });
    </script>
</body>
</html>
